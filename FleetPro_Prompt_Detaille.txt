# Prompt : Application SaaS B2B FleetPro - Gestion de Parc Automobile

## Vue d'ensemble
Cr√©er une application web SaaS B2B multi-tenant appel√©e **FleetPro** permettant aux entreprises de g√©rer leur parc automobile (voitures, utilitaires, camions, bus, engins). L'application doit supporter la gestion compl√®te des v√©hicules, chauffeurs, clients, suivi de carburant, planification de maintenance, tr√©sorerie et facturation.

## Stack Technologique
- **Frontend** : React 18 + TypeScript avec Vite
- **Backend** : Express.js + Node.js
- **Base de donn√©es** : PostgreSQL avec Drizzle ORM
- **Authentification** : Replit Auth (OpenID Connect)
- **UI** : Shadcn/UI + Tailwind CSS avec support Dark Mode
- **State Management** : TanStack Query v5
- **Tables** : TanStack Table avec recherche, tri et pagination
- **Design** : Interface enti√®rement responsive (mobile, tablette, desktop)

## Architecture Multi-Tenant

### Isolation des Donn√©es
- Chaque utilisateur appartient √† une organisation (tenant)
- Toutes les donn√©es sont isol√©es par `organizationId`
- Au premier login, l'utilisateur se voit automatiquement cr√©er une organisation
- Toutes les requ√™tes API filtrent automatiquement par organisation

### R√¥les Utilisateur
- `super_admin` : Acc√®s global
- `admin_entreprise` : Administrateur de l'organisation
- `gestionnaire` : Gestion op√©rationnelle
- `chauffeur` : Acc√®s limit√©

## Sch√©ma de Base de Donn√©es

### Tables Principales
1. **organizations** - Entreprises clientes (tenants)
2. **users** - Utilisateurs avec r√¥les et lien Replit Auth
3. **vehicles** - V√©hicules avec types (voiture, utilitaire, camion, bus, engin)
4. **drivers** - Chauffeurs assignables aux v√©hicules
5. **clients** - Clients de l'entreprise avec suivi de solde
6. **fuel_records** - Enregistrements de ravitaillement carburant
7. **maintenance_records** - Planification et suivi d'entretien avec urgence
8. **transactions** - Transactions financi√®res (recettes/d√©penses)
9. **invoices** - Factures clients avec suivi paiements
10. **organization_settings** - Param√®tres et personnalisation organisations
11. **sessions** - Sessions utilisateur PostgreSQL

## Fonctionnalit√©s par Module

### 1. Authentification
- Connexion via Replit Auth (Google, GitHub, Email)
- Auto-cr√©ation organisation au premier login
- Gestion session PostgreSQL
- Protection routes API avec middleware `isAuthenticated`
- Rafra√Æchissement automatique tokens

### 2. Dashboard
- **KPIs en temps r√©el** : V√©hicules actifs, chauffeurs, entretiens pr√©vus, revenus mensuels
- **Grille responsive** : 1 col mobile ‚Üí 2 cols tablet ‚Üí 4 cols desktop
- **Alertes maintenance** : Affichage entretiens urgents/bient√¥t avec badges color√©s
- **V√©hicules r√©cents** : Liste des derniers v√©hicules ajout√©s

### 3. Gestion des V√©hicules
- **Tableau interactif** avec TanStack Table
- **Colonnes** : Marque, Mod√®le, Type, Immatriculation, Kilom√©trage, Heures, Statut, Actions
- **Statuts** : disponible, en_location, en_maintenance, hors_service
- **Types** : voiture, utilitaire, camion, bus, engin
- **Actions inline** : Modifier (dialog pr√©-rempli), Supprimer (confirmation)
- **CRUD complet** : Ajout, modification, suppression avec validation Zod

### 4. Gestion des Chauffeurs
- **Tableau interactif** avec recherche par nom/pr√©nom/t√©l√©phone
- **Colonnes** : Nom, Pr√©nom, T√©l√©phone, V√©hicule Assign√©, Actions
- **Assignation v√©hicule** : Select dropdown avec liste v√©hicules disponibles
- **Actions inline** : Modifier, Supprimer avec confirmation

### 5. Gestion des Clients
- **Tableau interactif** avec recherche multi-crit√®res
- **Colonnes** : Nom, Entreprise, T√©l√©phone, Email, Solde, Actions
- **Badge solde** : Vert si positif, rouge si n√©gatif
- **CRUD complet** : Gestion compl√®te clients avec suivi financier

### 6. Suivi Carburant
- **Statistiques** : Co√ªt total, quantit√© totale, prix moyen/litre (grille 3 cols)
- **Tableau** : Date, V√©hicule, Chauffeur, Kilom√©trage, Quantit√©, Prix/L, Co√ªt Total
- **Calcul automatique** : Co√ªt total = quantit√© √ó prix unitaire
- **Format fran√ßais** : Dates, nombres et devises format√©s

### 7. Planification Maintenance
- **Statistiques** : Planifi√©s, Bient√¥t, Urgent, Termin√©s (grille 4 cols)
- **Badges urgence** : Vert (planifi√©), Jaune (bient√¥t), Rouge (urgent), Gris (termin√©)
- **Colonnes** : V√©hicule, Type entretien, Date pr√©vue, Kilom√©trage, Urgence, Co√ªt
- **Suivi** : Par kilom√©trage et/ou heures machine

### 8. Tr√©sorerie
- **Statistiques** : Recettes (vert), D√©penses (rouge), Solde (grille 3 cols)
- **Types** : recette, d√©pense avec badges color√©s
- **Cat√©gories** : location, vente, carburant, entretien, assurance, autre
- **Colonnes** : Date, Type, Cat√©gorie, V√©hicule, Client, Montant

### 9. Facturation
- **Statistiques** : Montant total, Montant pay√©, En attente, Impay√©es (grille 4 cols)
- **Statuts** : impay√©e (rouge), payee_partiellement (orange), payee (vert)
- **Colonnes** : N¬∞ Facture, Client, Date, √âch√©ance, Montant Total, Montant Pay√©, Statut
- **Suivi paiements** : Calcul automatique montant restant

### 10. Configuration
#### Param√®tres Entreprise
- Registre de commerce, NIS, NIF, Article d'imposition
- Adresse compl√®te

#### Administration
- Liste utilisateurs de l'organisation
- Modification r√¥les utilisateur
- Suppression utilisateurs (sauf soi-m√™me)

#### Personnalisation
- Couleurs de th√®me personnalis√©es
- Logo entreprise (upload)

## Design Responsive

### Breakpoints Tailwind
- Mobile : < 640px
- Tablet : 640px - 1023px
- Desktop : ‚â• 1024px

### Layout Principal
- **Padding adaptatif** : `px-4 sm:px-6 lg:px-8 py-4 sm:py-6`
- **Sidebar** : Auto-collapse sur mobile, expanded sur desktop
- **Toggle sidebar** : Bouton hamburger dans header

### Headers de Pages
- **Mobile** : Layout colonne (flex-col), titre 2xl, bouton texte court
- **Desktop** : Layout ligne (flex-row), titre 3xl, bouton texte complet
- **Exemple bouton** : `<span className="hidden xs:inline">Nouveau </span>V√©hicule`

### DataTable
- **Container** : `overflow-x-auto` pour scroll horizontal mobile
- **Pagination** : Responsive, colonnes sur mobile ‚Üí ligne sur desktop
- **Recherche** : Input adaptatif avec placeholder fran√ßais

### Grilles de Statistiques
- **Dashboard** : 1 col mobile ‚Üí 2 cols (md) ‚Üí 4 cols (lg)
- **Carburant/Tr√©sorerie** : 1 col ‚Üí 3 cols (md)
- **Maintenance/Factures** : 1 col ‚Üí 4 cols (md)

## Interface Utilisateur

### Composants Shadcn/UI
- **DataTable** : Composant r√©utilisable avec TanStack Table
- **Dialogs** : Pour ajout/modification entit√©s
- **AlertDialog** : Confirmations suppression
- **Form** : react-hook-form + zodResolver
- **Cards** : Statistiques et affichage donn√©es
- **Badges** : Statuts color√©s (variant selon contexte)
- **Buttons** : Variants (default, ghost, outline, destructive)
- **Sidebar** : Navigation principale avec SidebarProvider

### Conventions
- **Langue** : Toute l'interface en fran√ßais
- **Format dates** : dd/MM/yyyy (format fran√ßais)
- **Format nombres** : S√©parateur milliers espace, d√©cimale virgule
- **Devise** : DZD (Dinar Alg√©rien) ou ‚Ç¨ selon pr√©f√©rence
- **Dark mode** : Activ√© par d√©faut avec toggle
- **Icons** : Lucide React pour toutes les ic√¥nes

### Formulaires
- Validation Zod avec sch√©mas Drizzle
- Messages d'erreur en fran√ßais
- States loading avec spinners
- Toast notifications pour feedback utilisateur
- data-testid sur tous les √©l√©ments interactifs

## API Routes

### Structure
- Toutes les routes prot√©g√©es par `isAuthenticated` middleware
- Filtrage automatique par `organizationId` depuis `req.user`
- Validation Zod des body requests
- Gestion erreurs avec try/catch et messages explicites

### Endpoints Principaux
```
GET    /api/auth/user           - Utilisateur connect√©
GET    /api/login               - Initier login
GET    /api/logout              - D√©connexion
GET    /api/callback            - Callback OAuth

GET    /api/vehicles            - Liste v√©hicules
POST   /api/vehicles            - Cr√©er v√©hicule
PATCH  /api/vehicles/:id        - Modifier v√©hicule
DELETE /api/vehicles/:id        - Supprimer v√©hicule

GET    /api/drivers             - Liste chauffeurs
POST   /api/drivers             - Cr√©er chauffeur
PATCH  /api/drivers/:id         - Modifier chauffeur
DELETE /api/drivers/:id         - Supprimer chauffeur

GET    /api/clients             - Liste clients
POST   /api/clients             - Cr√©er client
PATCH  /api/clients/:id         - Modifier client
DELETE /api/clients/:id         - Supprimer client

GET    /api/fuel-records        - Enregistrements carburant
POST   /api/fuel-records        - Cr√©er enregistrement
DELETE /api/fuel-records/:id    - Supprimer enregistrement

GET    /api/maintenance         - Enregistrements maintenance
POST   /api/maintenance         - Cr√©er enregistrement
PATCH  /api/maintenance/:id     - Modifier (marquer termin√©)
DELETE /api/maintenance/:id     - Supprimer enregistrement

GET    /api/transactions        - Transactions
POST   /api/transactions        - Cr√©er transaction
DELETE /api/transactions/:id    - Supprimer transaction

GET    /api/invoices            - Factures
POST   /api/invoices            - Cr√©er facture
DELETE /api/invoices/:id        - Supprimer facture

GET    /api/dashboard/stats     - Statistiques dashboard

GET    /api/settings            - Param√®tres organisation
PUT    /api/settings            - Modifier param√®tres

GET    /api/users               - Utilisateurs organisation
PATCH  /api/users/:id           - Modifier r√¥le
DELETE /api/users/:id           - Supprimer utilisateur
```

## Tests End-to-End

### Playwright Tests
- Tests sur 5 tailles d'√©cran (375px, 428px, 768px, 1280px, 1920px)
- Validation CRUD pour toutes les entit√©s
- Tests navigation et sidebar
- Tests formulaires et validation
- Tests responsive design
- Tests authentification OIDC

### Coverage
- Toutes les pages de donn√©es test√©es
- Tous les flux CRUD valid√©s
- Responsive v√©rifi√© sur mobile, tablette, desktop

## Configuration Projet

### Structure Fichiers
```
client/
  src/
    components/      - Composants UI r√©utilisables
    pages/          - Pages de l'application
    hooks/          - Custom hooks (useAuth, useMobile)
    lib/            - Utils et queryClient
server/
  routes.ts         - Routes API Express
  auth.ts           - Configuration Replit Auth
  index.ts          - Point d'entr√©e serveur
shared/
  schema.ts         - Sch√©ma Drizzle + types Zod
```

### Scripts
```bash
npm run dev           # D√©marrer dev (frontend + backend)
npm run db:push       # Synchroniser sch√©ma DB
npm run db:studio     # Ouvrir Drizzle Studio
```

---

**Ce prompt d√©crit une application compl√®te, test√©e et pr√™te pour la production avec design responsive professionnel adapt√© aux entreprises de gestion de flotte automobile.** üöó‚ú®
